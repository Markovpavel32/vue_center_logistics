{"remainingRequest":"/Users/user/workspace/pa_center_logistics/vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/user/workspace/pa_center_logistics/vue/src/components/application_log/ApplicationCreate.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/user/workspace/pa_center_logistics/vue/src/components/application_log/ApplicationCreate.vue","mtime":1585147743691},{"path":"/Users/user/workspace/pa_center_logistics/vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/user/workspace/pa_center_logistics/vue/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/user/workspace/pa_center_logistics/vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/user/workspace/pa_center_logistics/vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/user/workspace/pa_center_logistics/vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JwppbXBvcnQgUHJvZHVjdEFkZCBmcm9tICcuLi9wcm9kdWN0L1Byb2R1Y3RBZGQnCmltcG9ydCB7IEFqYXhPcGVyYXRvciB9IGZyb20gJy4uLy4uL2xpYi9heGlvcycKaW1wb3J0IFByb2R1Y3RzVGFibGUgZnJvbSAnLi4vcHJvZHVjdC9Qcm9kdWN0c1RhYmxlJwppbXBvcnQgZGVib3VuY2UgZnJvbSAnbG9kYXNoLmRlYm91bmNlJwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdhcHBsaWNhdGlvbi1jcmVhdGUnLAogIGNvbXBvbmVudHM6IHsKICAgIFByb2R1Y3RzVGFibGUsCiAgICBQcm9kdWN0QWRkCiAgfSwKICBwcm9wczogewogICAgdHlwZTogewogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgdHlwZTogU3RyaW5nCiAgICB9LAogICAgdGl0bGU6IHsKICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICBkZWZhdWx0OiAn0J3QvtCy0LDRjyDQt9Cw0Y/QstC60LAnLAogICAgICB0eXBlOiBTdHJpbmcKICAgIH0sCiAgICBpdGVtOiB7CiAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgdHlwZTogT2JqZWN0CiAgICB9LAogICAgaXNfZWRpdF9tb2RlOiB7CiAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogdHJ1ZQogICAgfQogIH0sCiAgZGF0YSAoKSB7CiAgICByZXR1cm4gewogICAgICBtb21lbnQsCiAgICAgIG1vZGVsOiB7CiAgICAgICAgZG9jdW1lbnRfZGF0ZTogbW9tZW50KG5ldyBEYXRlKCkpLmZvcm1hdCgnREQuTU0uWVlZWScpLAogICAgICAgIGRvY3VtZW50X251bWJlcjogJycsCiAgICAgICAgc2NoZWR1bGVkX2RhdGU6ICcnLAogICAgICAgIGRvY3VtZW50X2xpbmVzOiBbXSwKICAgICAgICBzZWxmX2RlbGl2ZXJ5OiBmYWxzZSwKICAgICAgICBjb25zaWduZWU6ICcnLAogICAgICAgIGl0X3JldHVybjogZmFsc2UsCiAgICAgICAgbm90ZTogJycsCiAgICAgICAgaWQ6ICcnCiAgICAgIH0sCiAgICAgIGRhdGVwaWNrZXJfb3B0aW9uczogewogICAgICAgIGZvcm1hdDogJ0RELk1NLllZWVknLAogICAgICAgIGxvY2FsZTogJ3J1JwogICAgICB9LAogICAgICBwcm9kdWN0czogW10sCiAgICAgIG1vZGFsX3Nob3c6IGZhbHNlLAogICAgICBjb25zaWduZWVfbGlzdDogW10sCiAgICAgIHF1ZXJ5OiAnJwogICAgfQogIH0sCgogIGNyZWF0ZWQgKCkgewogICAgaWYgKHRoaXMuaXRlbSkgewogICAgICB0aGlzLm1vZGVsID0gewogICAgICAgIC4uLnRoaXMubW9kZWwsCiAgICAgICAgZG9jdW1lbnRfZGF0ZTogbW9tZW50KHRoaXMuaXRlbS5kb2N1bWVudF9kYXRlKS5mb3JtYXQoJ0RELk1NLllZWVknKSwKICAgICAgICBkb2N1bWVudF9udW1iZXI6IHRoaXMuaXRlbS5kb2N1bWVudF9udW1iZXIsCiAgICAgICAgc2NoZWR1bGVkX2RhdGU6IG1vbWVudCh0aGlzLml0ZW0uc2NoZWR1bGVkX2RhdGUpLmZvcm1hdCgnREQuTU0uWVlZWScpLAogICAgICAgIGlkOiB0aGlzLml0ZW0uaWQKICAgICAgfQogICAgICBpZiAodGhpcy5pdGVtLmNvbnNpZ25lZV9uYW1lKSB7CiAgICAgICAgdGhpcy5xdWVyeSA9IHRoaXMuaXRlbS5jb25zaWduZWVfbmFtZQogICAgICAgIHRoaXMuY29uc2lnbmVlX2xpc3QucHVzaCh7IG5hbWU6IHRoaXMuaXRlbS5jb25zaWduZWVfbmFtZSwgaWQ6IHRoaXMuaXRlbS5jb25zaWduZWVfaWQgfSkKICAgICAgfQoKICAgICAgaWYgKHRoaXMuaXRlbS5pdF9yZXR1cm4pIHsKICAgICAgICB0aGlzLm1vZGVsLml0X3JldHVybiA9IHRydWUKICAgICAgfQoKICAgICAgbmV3IEFqYXhPcGVyYXRvcihgL2FwcGxpY2F0aW9uX2xvZy8ke3RoaXMudHlwZX0vcHJvZHVjdHNgLCB0aGlzLiRzdG9yZSwgJ3Byb2R1Y3RzJykKICAgICAgICAuZ2V0KHsKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBpZDogdGhpcy5pdGVtLmlkCiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAudGhlbihkYXRhID0+IHsKICAgICAgICAgIHRoaXMucHJvZHVjdHMgPSBkYXRhLnJlc3VsdAogICAgICAgICAgdGhpcy5tb2RlbC5kb2N1bWVudF9saW5lcyA9IGRhdGEucmVzdWx0CiAgICAgICAgfSkKICAgIH0KICB9LAoKICB3YXRjaDogewogICAgcXVlcnk6IGRlYm91bmNlKGZ1bmN0aW9uIChuZXdfcXVlcnkpIHsKICAgICAgbmV3IEFqYXhPcGVyYXRvcihgL2FwcGxpY2F0aW9uX2xvZy90b19pc3N1ZS9jb25zaWduZWVzYCwgdGhpcy4kc3RvcmUsICdjb25zaWduZWVzJykuZ2V0KHsKICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgIG5hbWU6IG5ld19xdWVyeQogICAgICAgIH0KICAgICAgfSkKICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICB0aGlzLmNvbnNpZ25lZV9saXN0ID0gcmVzcG9uc2UucmVzdWx0CiAgICAgICAgfSkKICAgIH0sIDUwMCkKICB9LAoKICBtZXRob2RzOiB7CiAgICBhZGQgKHByb2R1Y3QpIHsKICAgICAgdGhpcy5wcm9kdWN0cy5wdXNoKHByb2R1Y3QpCiAgICAgIHRoaXMubW9kZWwuZG9jdW1lbnRfbGluZXMucHVzaCh7ICdwcm9kdWN0JzogcHJvZHVjdC5pZCwgdW5pdDogcHJvZHVjdC5wcm9kdWN0X2RldGFpbF9pZCwgcXVhbnRpdHk6IDAgfSkKICAgIH0sCgogICAgY3JlYXRlX2FwcGxpY2F0aW9uICgpIHsKICAgICAgbGV0IGRhdGEgPSB7fQogICAgICBkYXRhID0gdGhpcy5wcmVwYXJlX2RhdGEoZGF0YSkKICAgICAgbmV3IEFqYXhPcGVyYXRvcihgL2FwcGxpY2F0aW9uX2xvZy8ke3RoaXMudHlwZX1gKQogICAgICAgIC5wb3N0KGRhdGEpCiAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHRoaXMuJGVtaXQoJ2Nsb3NlJywgZmFsc2UpKQogICAgfSwKCiAgICByZW1vdmVfcHJvZHVjdCAoaW5kZXgpIHsKICAgICAgdGhpcy5wcm9kdWN0cy5zcGxpY2UoaW5kZXgsIDEpCiAgICAgIHRoaXMubW9kZWwuZG9jdW1lbnRfbGluZXMuc3BsaWNlKGluZGV4LCAxKQogICAgfSwKCiAgICBwcmVwYXJlX2RhdGEgKGRhdGEpIHsKICAgICAgZGF0YSA9IHsKICAgICAgICBkb2N1bWVudF9kYXRlOiBtb21lbnQodGhpcy5tb2RlbC5kb2N1bWVudF9kYXRlLCAnREQuTU0uWVlZWScsICdydScpLmZvcm1hdCgnWVlZWS1NTS1ERFRoaDptbTpzcy5TU1NaJyksCiAgICAgICAgc2NoZWR1bGVkX2RhdGU6IG1vbWVudCh0aGlzLm1vZGVsLnNjaGVkdWxlZF9kYXRlLCAnREQuTU0uWVlZWScsICdydScpLmZvcm1hdCgnWVlZWS1NTS1ERFRoaDptbTpzcy5TU1NaJyksCiAgICAgICAgZG9jdW1lbnRfbnVtYmVyOiB0aGlzLm1vZGVsLmRvY3VtZW50X251bWJlciwKICAgICAgICBkb2N1bWVudF9saW5lczogWy4uLnRoaXMubW9kZWwuZG9jdW1lbnRfbGluZXNdCiAgICAgIH0KICAgICAgaWYgKHRoaXMudHlwZSA9PT0gJ2FwcG9pbnRtZW50JykgewogICAgICAgIGlmICh0aGlzLm1vZGVsLml0X3JldHVybikgewogICAgICAgICAgZGF0YS5pdF9yZXR1cm4gPSB0aGlzLm1vZGVsLml0X3JldHVybgogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0aGlzLnR5cGUgPT09ICd0b19pc3N1ZScpIHsKICAgICAgICBkYXRhLm5lZWRfZGVsaXZlcnkgPSAhdGhpcy5tb2RlbC5zZWxmX2RlbGl2ZXJ5CiAgICAgICAgZGF0YS5jb25zaWduZWUgPSB0aGlzLm1vZGVsLmNvbnNpZ25lZQogICAgICB9CiAgICAgIGlmICh0aGlzLm1vZGVsLm5vdGUpIHsKICAgICAgICBkYXRhLm5vdGUgPSB0aGlzLm1vZGVsLm5vdGUKICAgICAgfQogICAgICBpZiAodGhpcy5tb2RlbC5pZCkgewogICAgICAgIGRhdGEuZG9jdW1lbnRfaWQgPSB0aGlzLm1vZGVsLmlkCiAgICAgIH0KICAgICAgcmV0dXJuIGRhdGEKICAgIH0KICB9Cn0K"},{"version":3,"sources":["ApplicationCreate.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ApplicationCreate.vue","sourceRoot":"src/components/application_log","sourcesContent":["<template>\n  <div>\n    <b-card bg-variant=\"light\">\n      <i @click=\"$emit('close', false)\" class=\"icon-remove ml-auto d-flex flex-row-reverse clickable\"></i>\n      <div class=\"d-flex justify-content-between\">\n        <b-card-title>\n          <span class=\"mr-default\">{{ title }}</span>\n          <slot name=\"status\"></slot>\n        </b-card-title>\n        <div>\n          <slot name=\"actions\"></slot>\n        </div>\n      </div>\n      <div class=\"row mb-default\">\n        <div class=\"col-sm-3\">\n          <label class=\"d-flex align-items-center\">\n            <span class=\"mr-default\">Дата заявки:</span>\n            <b-input class=\"col-sm-6\" :value=\"model.document_date\" readonly></b-input>\n          </label>\n        </div>\n        <div class=\"col-sm-4\">\n          <label class=\"d-flex align-items-center\">\n            <span class=\"mr-default\">Номер заявки:</span>\n            <b-input class=\"col-sm-7\"\n                     required\n                     v-model=\"model.document_number\"\n                     placeholder=\"Укажите номер заявки\"\n                     :readonly=\"!is_edit_mode\"></b-input>\n          </label>\n        </div>\n        <div class=\"col-sm-5\">\n          <label class=\"d-flex align-items-center\">\n            <span class=\"mr-default\">Дата доставки:</span>\n            <date-picker v-model=\"model.scheduled_date\"\n                         class=\"form-control\"\n                         :config=\"datepicker_options\"\n                         :disabled=\"!is_edit_mode\"></date-picker>\n          </label>\n        </div>\n      </div>\n      <div class=\"row mb-default\" v-if=\"type === 'appointment'\">\n        <div class=\"col-sm-3\">Заявка является возвратом?</div>\n        <div class=\"col-sm-1\">\n          <div class=\"d-flex\"><span>Да</span><b-radio v-model=\"model.it_return\" :value=\"true\"></b-radio></div>\n        </div>\n        <div class=\"col-sm-1\">\n          <div class=\"d-flex\"><span>Нет</span><b-radio v-model=\"model.it_return\" :value=\"false\"></b-radio></div>\n        </div>\n      </div>\n      <div class=\"row mb-default\" v-if=\"type === 'to_issue'\">\n        <div class=\"col-sm-3\">Самостоятельно доставлю груз</div>\n        <div class=\"col-sm-1\">\n          <div class=\"d-flex\"><b-checkbox v-model=\"model.self_delivery\" :disabled=\"!is_edit_mode\"></b-checkbox></div>\n        </div>\n      </div>\n      <div v-if=\"type === 'to_issue'\" class=\"row mb-default d-flex align-items-center\">\n        <div class=\"col-sm-2\">Грузополучатель:</div>\n        <b-input v-if=\"!is_edit_mode\" class=\"col-sm-6 pl-0\" v-model=\"query\" readonly/>\n        <vue-bootstrap-typeahead v-else class=\"col-sm-6 pl-0\"\n                                 v-model=\"query\"\n                                 :serializer=\"item => item.consignee_name\"\n                                 :data=\"consignee_list\"\n                                 @hit=\"model.consignee = $event.id\"\n                                 >\n          <template slot=\"suggestion\" slot-scope=\"{ data }\">\n            <div>\n              {{ data.consignee_name }}\n            </div>\n            <div class=\"text-secondary\">\n              <small>{{ data.consignee_address }}</small>\n            </div>\n          </template>\n        </vue-bootstrap-typeahead>\n      </div>\n      <div class=\"row mb-default\">\n        <div class=\"col-sm-2\">Примечание:</div>\n        <b-textarea v-model=\"model.note\" class=\"col-sm-10\" :disabled=\"!is_edit_mode\"></b-textarea>\n      </div>\n      <div class=\"row mb-default\">\n        <div class=\"col-sm-2\">Список товаров:</div>\n      </div>\n      <products-table :is_edit_mode=\"is_edit_mode\" @remove_product=\"remove_product\" :model.sync=\"model\" :products=\"products\" :key=\"item && item.id\"></products-table>\n      <div class=\"row justify-content-between\">\n        <div class=\"col-sm-2\" >\n          <b-button v-if=\"is_edit_mode\" variant=\"primary\" @click=\"modal_show = !modal_show\" squared>Добавить товар</b-button>\n        </div>\n        <div class=\"col-sm-2\" >\n          <b-button v-if=\"model.document_lines.length && is_edit_mode\" variant=\"warning\" @click=\"create_application\" squared>Создать заявку</b-button>\n        </div>\n      </div>\n    </b-card>\n    <product-add @add=\"add\" v-if=\"modal_show\" :modal_show=\"modal_show\" @change=\"modal_show = $event\"></product-add>\n  </div>\n</template>\n\n<script>\nimport moment from 'moment'\nimport ProductAdd from '../product/ProductAdd'\nimport { AjaxOperator } from '../../lib/axios'\nimport ProductsTable from '../product/ProductsTable'\nimport debounce from 'lodash.debounce'\n\nexport default {\n  name: 'application-create',\n  components: {\n    ProductsTable,\n    ProductAdd\n  },\n  props: {\n    type: {\n      required: true,\n      type: String\n    },\n    title: {\n      required: false,\n      default: 'Новая заявка',\n      type: String\n    },\n    item: {\n      required: false,\n      type: Object\n    },\n    is_edit_mode: {\n      required: false,\n      type: Boolean,\n      default: true\n    }\n  },\n  data () {\n    return {\n      moment,\n      model: {\n        document_date: moment(new Date()).format('DD.MM.YYYY'),\n        document_number: '',\n        scheduled_date: '',\n        document_lines: [],\n        self_delivery: false,\n        consignee: '',\n        it_return: false,\n        note: '',\n        id: ''\n      },\n      datepicker_options: {\n        format: 'DD.MM.YYYY',\n        locale: 'ru'\n      },\n      products: [],\n      modal_show: false,\n      consignee_list: [],\n      query: ''\n    }\n  },\n\n  created () {\n    if (this.item) {\n      this.model = {\n        ...this.model,\n        document_date: moment(this.item.document_date).format('DD.MM.YYYY'),\n        document_number: this.item.document_number,\n        scheduled_date: moment(this.item.scheduled_date).format('DD.MM.YYYY'),\n        id: this.item.id\n      }\n      if (this.item.consignee_name) {\n        this.query = this.item.consignee_name\n        this.consignee_list.push({ name: this.item.consignee_name, id: this.item.consignee_id })\n      }\n\n      if (this.item.it_return) {\n        this.model.it_return = true\n      }\n\n      new AjaxOperator(`/application_log/${this.type}/products`, this.$store, 'products')\n        .get({\n          params: {\n            id: this.item.id\n          }\n        })\n        .then(data => {\n          this.products = data.result\n          this.model.document_lines = data.result\n        })\n    }\n  },\n\n  watch: {\n    query: debounce(function (new_query) {\n      new AjaxOperator(`/application_log/to_issue/consignees`, this.$store, 'consignees').get({\n        params: {\n          name: new_query\n        }\n      })\n        .then(response => {\n          this.consignee_list = response.result\n        })\n    }, 500)\n  },\n\n  methods: {\n    add (product) {\n      this.products.push(product)\n      this.model.document_lines.push({ 'product': product.id, unit: product.product_detail_id, quantity: 0 })\n    },\n\n    create_application () {\n      let data = {}\n      data = this.prepare_data(data)\n      new AjaxOperator(`/application_log/${this.type}`)\n        .post(data)\n        .then(result => this.$emit('close', false))\n    },\n\n    remove_product (index) {\n      this.products.splice(index, 1)\n      this.model.document_lines.splice(index, 1)\n    },\n\n    prepare_data (data) {\n      data = {\n        document_date: moment(this.model.document_date, 'DD.MM.YYYY', 'ru').format('YYYY-MM-DDThh:mm:ss.SSSZ'),\n        scheduled_date: moment(this.model.scheduled_date, 'DD.MM.YYYY', 'ru').format('YYYY-MM-DDThh:mm:ss.SSSZ'),\n        document_number: this.model.document_number,\n        document_lines: [...this.model.document_lines]\n      }\n      if (this.type === 'appointment') {\n        if (this.model.it_return) {\n          data.it_return = this.model.it_return\n        }\n      } else if (this.type === 'to_issue') {\n        data.need_delivery = !this.model.self_delivery\n        data.consignee = this.model.consignee\n      }\n      if (this.model.note) {\n        data.note = this.model.note\n      }\n      if (this.model.id) {\n        data.document_id = this.model.id\n      }\n      return data\n    }\n  }\n}\n</script>\n"]}]}
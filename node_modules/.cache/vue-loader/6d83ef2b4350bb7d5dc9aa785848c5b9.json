{"remainingRequest":"/Users/user/workspace/pa_center_logistics/vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/user/workspace/pa_center_logistics/vue/src/components/application_log/ApplicationLogToIssue.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/user/workspace/pa_center_logistics/vue/src/components/application_log/ApplicationLogToIssue.vue","mtime":1585054842765},{"path":"/Users/user/workspace/pa_center_logistics/vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/user/workspace/pa_center_logistics/vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/user/workspace/pa_center_logistics/vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/user/workspace/pa_center_logistics/vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IEFqYXhPcGVyYXRvciB9IGZyb20gJy4uLy4uL2xpYi9heGlvcycKaW1wb3J0IHsgU1RBVFVTX0JBREdFUyB9IGZyb20gJy4vQ09OU1RBTlRTJwppbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCcKaW1wb3J0IEFwcGxpY2F0aW9uQ3JlYXRlIGZyb20gJy4vQXBwbGljYXRpb25DcmVhdGUnCmltcG9ydCBBcHBsaWNhdGlvbkxvZ0RldGFpbHMgZnJvbSAnLi9BcHBsaWNhdGlvbkxvZ0RldGFpbHMnCmltcG9ydCBkZWJvdW5jZSBmcm9tICdsb2Rhc2guZGVib3VuY2UnCmltcG9ydCBQYWdlSGVhZGVyIGZyb20gJy4uL2NvbW1vbi9QYWdlSGVhZGVyJwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdhcHBsaWNhdGlvbi1sb2ctdG8taXNzdWUnLAogIGNvbXBvbmVudHM6IHsgUGFnZUhlYWRlciwgQXBwbGljYXRpb25Mb2dEZXRhaWxzLCBBcHBsaWNhdGlvbkNyZWF0ZSB9LAogIGRhdGEgKCkgewogICAgcmV0dXJuIHsKICAgICAgcGVuZGluZzogZmFsc2UsCiAgICAgIGN1cnJlbnRfcGFnZTogMSwKICAgICAgZGF0YTogW10sCiAgICAgIHRvdGFsX3Jvd3M6IDAsCiAgICAgIHBlcl9wYWdlOiAyMCwKICAgICAgZmllbGRzOiBbCiAgICAgICAgewogICAgICAgICAga2V5OiAnZG9jdW1lbnRfZGF0ZScsCiAgICAgICAgICBsYWJlbDogJ9CU0LDRgtCwINGB0L7Qt9C00LDQvdC40Y8nLAogICAgICAgICAgc29ydGFibGU6IHRydWUsCiAgICAgICAgICBmb3JtYXR0ZXI6ICh2YWx1ZSkgPT4gbW9tZW50KHZhbHVlKS5mb3JtYXQoJ0RELk1NLllZWVkgaGg6bW0nKQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAga2V5OiAnZG9jdW1lbnRfbnVtYmVyJywKICAgICAgICAgIGxhYmVsOiAn0J3QvtC80LXRgCDQt9Cw0Y/QstC60LgnLAogICAgICAgICAgc29ydGFibGU6IGZhbHNlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBrZXk6ICdjb25zaWduZWVfbmFtZScsCiAgICAgICAgICBsYWJlbDogJ9CT0YDRg9C30L7Qv9C+0LvRg9GH0LDRgtC10LvRjCcsCiAgICAgICAgICBzb3J0YWJsZTogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAga2V5OiAnc2NoZWR1bGVkX2RhdGUnLAogICAgICAgICAgbGFiZWw6ICfQn9C70LDQvdC+0LLQsNGPINC00LDRgtCwINCy0YvQtNCw0YfQuCcsCiAgICAgICAgICBzb3J0YWJsZTogdHJ1ZSwKICAgICAgICAgIGZvcm1hdHRlcjogKHZhbHVlKSA9PiBtb21lbnQodmFsdWUpLmZvcm1hdCgnREQuTU0uWVlZWSBoaDptbScpCiAgICAgICAgfQogICAgICBdLAogICAgICBpc19jcmVhdGU6IGZhbHNlLAogICAgICB0YWJsZV9zb3J0aW5nOiB7CiAgICAgICAgc29ydF9ieTogJ2RvY3VtZW50X2RhdGUnLAogICAgICAgIHNvcnRfZGVzYzogdHJ1ZQogICAgICB9CiAgICB9CiAgfSwKCiAgY3JlYXRlZCAoKSB7CiAgICB0aGlzLmdldF9hcHBsaWNhdGlvbnMoKQogIH0sCgogIHdhdGNoOiB7CiAgICB0YWJsZV9zb3J0aW5nOiB7CiAgICAgIGhhbmRsZXI6IGFzeW5jIGZ1bmN0aW9uIChuZXdfdGFibGVfc29ydGluZykgewogICAgICAgIGRlYm91bmNlKGFzeW5jIChuZXdfdGFibGVfc29ydGluZykgPT4gewogICAgICAgICAgaWYgKG5ld190YWJsZV9zb3J0aW5nLnNvcnRfYnkpIHsKICAgICAgICAgICAgdGhpcy50b2dnbGVfcGVuZGluZygpCiAgICAgICAgICAgIGF3YWl0IG5ldyBBamF4T3BlcmF0b3IoJ2FwcGxpY2F0aW9uX2xvZy90b19pc3N1ZScsIHRoaXMuJHN0b3JlLCAnYXBwbGljYXRpb25fYXBwb2ludG1lbnQnKS5nZXQoewogICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgcGFnZTogdGhpcy5jdXJyZW50X3BhZ2UsCiAgICAgICAgICAgICAgICBsaW1pdDogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICAgIHNvcnRfYnk6IG5ld190YWJsZV9zb3J0aW5nLnNvcnRfYnksCiAgICAgICAgICAgICAgICBzb3J0X2Rlc2M6IG5ld190YWJsZV9zb3J0aW5nLnNvcnRfZGVzYwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGEucmVzdWx0CiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3Jvd3MgPSBkYXRhLnRvdGFsCiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZV9wZW5kaW5nKCkKICAgICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgIH0sIDUwMCkobmV3X3RhYmxlX3NvcnRpbmcpCiAgICAgIH0sCiAgICAgIGRlZXA6IHRydWUKICAgIH0KICB9LAoKICBtZXRob2RzOiB7CiAgICB0b2dnbGVfcGVuZGluZyAoKSB7CiAgICAgIHRoaXMucGVuZGluZyA9ICF0aGlzLnBlbmRpbmcKICAgIH0sCgogICAgc3RhdHVzX2JhZGdlICh2YWx1ZSkgewogICAgICByZXR1cm4gU1RBVFVTX0JBREdFU1t2YWx1ZV0KICAgIH0sCgogICAgZ2V0X2FwcGxpY2F0aW9ucyAocGFnZSA9IDEpIHsKICAgICAgdGhpcy50b2dnbGVfcGVuZGluZygpCiAgICAgIG5ldyBBamF4T3BlcmF0b3IoJ2FwcGxpY2F0aW9uX2xvZy90b19pc3N1ZScsIHRoaXMuJHN0b3JlLCAnYXBwbGljYXRpb25fdG9faXNzdWUnKS5nZXQoewogICAgICAgIHBhcmFtczogewogICAgICAgICAgcGFnZSwKICAgICAgICAgIGxpbWl0OiB0aGlzLnBlcl9wYWdlLAogICAgICAgICAgc29ydF9ieTogdGhpcy50YWJsZV9zb3J0aW5nLnNvcnRfYnksCiAgICAgICAgICBzb3J0X2Rlc2M6IHRoaXMudGFibGVfc29ydGluZy5zb3J0X2Rlc2MKICAgICAgICB9CiAgICAgIH0pCiAgICAgICAgLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhLnJlc3VsdAogICAgICAgICAgdGhpcy50b3RhbF9yb3dzID0gZGF0YS50b3RhbAogICAgICAgICAgdGhpcy50b2dnbGVfcGVuZGluZygpCiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goZSA9PiB7CiAgICAgICAgICBpZiAoZS5yZXNwb25zZS5zdGF0dXMgPT09IDQwNCkgdGhpcy4kcm91dGVyLnB1c2goeyBuYW1lOiAnbG9naW4nLCBwYXJhbXM6IHsgZXJyb3JfdGV4dDogJ9CS0L7QudC00YLQuNGC0LUg0LIg0LvQuNGH0L3Ri9C5INC60LDQsdC40L3QtdGCJyB9IH0pCiAgICAgICAgfSkKICAgIH0sCgogICAgdG9nZ2xlX2RldGFpbHMgKGl0ZW0pIHsKICAgICAgdGhpcy4kc2V0KGl0ZW0sICdfc2hvd0RldGFpbHMnLCAhaXRlbS5fc2hvd0RldGFpbHMpCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["ApplicationLogToIssue.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"ApplicationLogToIssue.vue","sourceRoot":"src/components/application_log","sourcesContent":["<template>\n<div>\n  <page-header title=\"Заявки на выдачу товаров\">\n    <template slot=\"actions\">\n      <b-button variant=\"warning\" squared class=\"d-flex align-items-center\" @click=\"is_create = !is_create\">\n        <img src=\"../../assets/plus-warning-filled.png\" width=\"24\" hight=\"24\"/>\n        <span>Создать заявку</span>\n      </b-button>\n    </template>\n  </page-header>\n  <application-create type=\"to_issue\" @close=\"is_create = $event\" v-if=\"is_create\"></application-create>\n  <b-table id=\"application_log_appointment_table\" hover small no-local-sorting\n           :busy=\"pending\"\n           style=\"border: 2px solid white; font-size: 13px; line-height: 16px\"\n           :items=\"data\"\n           :fields=\"fields\"\n           :current-page=\"current_page\"\n           :sort-by.sync=\"table_sorting.sort_by\"\n           :sort-desc.sync=\"table_sorting.sort_desc\"\n           @row-clicked=\"toggle_details\">\n    <template v-slot:table-busy>\n      <div class=\"text-center text-danger my-2\">\n        <b-spinner class=\"align-middle\"></b-spinner>\n        <strong>Загрузка...</strong>\n      </div>\n    </template>\n    <template v-slot:cell(status)=\"data\">\n      <span class=\"badge\"  :class=\"status_badge(data.value)\">{{ data.value }}</span>\n    </template>\n    <template v-slot:row-details=\"row\">\n      <application-log-details\n        @close=\"toggle_details\"\n        title=\"Заявка на выдачу товара\"\n        type=\"to_issue\"\n        :item=\"row.item\"></application-log-details>\n    </template>\n  </b-table>\n  <b-pagination v-model=\"current_page\"\n                :total-rows=\"total_rows\"\n                :per-page=\"per_page\"\n                @change=\"get_applications\"\n                aria-controls=\"application_log_table\"></b-pagination>\n</div>\n</template>\n\n<script>\nimport { AjaxOperator } from '../../lib/axios'\nimport { STATUS_BADGES } from './CONSTANTS'\nimport moment from 'moment'\nimport ApplicationCreate from './ApplicationCreate'\nimport ApplicationLogDetails from './ApplicationLogDetails'\nimport debounce from 'lodash.debounce'\nimport PageHeader from '../common/PageHeader'\n\nexport default {\n  name: 'application-log-to-issue',\n  components: { PageHeader, ApplicationLogDetails, ApplicationCreate },\n  data () {\n    return {\n      pending: false,\n      current_page: 1,\n      data: [],\n      total_rows: 0,\n      per_page: 20,\n      fields: [\n        {\n          key: 'document_date',\n          label: 'Дата создания',\n          sortable: true,\n          formatter: (value) => moment(value).format('DD.MM.YYYY hh:mm')\n        },\n        {\n          key: 'document_number',\n          label: 'Номер заявки',\n          sortable: false\n        },\n        {\n          key: 'consignee_name',\n          label: 'Грузополучатель',\n          sortable: true\n        },\n        {\n          key: 'scheduled_date',\n          label: 'Плановая дата выдачи',\n          sortable: true,\n          formatter: (value) => moment(value).format('DD.MM.YYYY hh:mm')\n        }\n      ],\n      is_create: false,\n      table_sorting: {\n        sort_by: 'document_date',\n        sort_desc: true\n      }\n    }\n  },\n\n  created () {\n    this.get_applications()\n  },\n\n  watch: {\n    table_sorting: {\n      handler: async function (new_table_sorting) {\n        debounce(async (new_table_sorting) => {\n          if (new_table_sorting.sort_by) {\n            this.toggle_pending()\n            await new AjaxOperator('application_log/to_issue', this.$store, 'application_appointment').get({\n              params: {\n                page: this.current_page,\n                limit: this.per_page,\n                sort_by: new_table_sorting.sort_by,\n                sort_desc: new_table_sorting.sort_desc\n              }\n            })\n              .then(data => {\n                this.data = data.result\n                this.total_rows = data.total\n                this.toggle_pending()\n              })\n          }\n        }, 500)(new_table_sorting)\n      },\n      deep: true\n    }\n  },\n\n  methods: {\n    toggle_pending () {\n      this.pending = !this.pending\n    },\n\n    status_badge (value) {\n      return STATUS_BADGES[value]\n    },\n\n    get_applications (page = 1) {\n      this.toggle_pending()\n      new AjaxOperator('application_log/to_issue', this.$store, 'application_to_issue').get({\n        params: {\n          page,\n          limit: this.per_page,\n          sort_by: this.table_sorting.sort_by,\n          sort_desc: this.table_sorting.sort_desc\n        }\n      })\n        .then(data => {\n          this.data = data.result\n          this.total_rows = data.total\n          this.toggle_pending()\n        })\n        .catch(e => {\n          if (e.response.status === 404) this.$router.push({ name: 'login', params: { error_text: 'Войдтите в личный кабинет' } })\n        })\n    },\n\n    toggle_details (item) {\n      this.$set(item, '_showDetails', !item._showDetails)\n    }\n  }\n}\n</script>\n"]}]}
{"remainingRequest":"/Users/user/workspace/pa_center_logistics/vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/user/workspace/pa_center_logistics/vue/src/components/product/ProductsList.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/user/workspace/pa_center_logistics/vue/src/components/product/ProductsList.vue","mtime":1586954425831},{"path":"/Users/user/workspace/pa_center_logistics/vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/user/workspace/pa_center_logistics/vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/user/workspace/pa_center_logistics/vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/user/workspace/pa_center_logistics/vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBQYWdlSGVhZGVyIGZyb20gJy4uL2NvbW1vbi9QYWdlSGVhZGVyJwppbXBvcnQgeyBBamF4T3BlcmF0b3IgfSBmcm9tICcuLi8uLi9saWIvYXhpb3MnCmltcG9ydCBkZWJvdW5jZSBmcm9tICdsb2Rhc2guZGVib3VuY2UnCmltcG9ydCBQcm9kdWN0Q3JlYXRlIGZyb20gJy4vUHJvZHVjdENyZWF0ZScKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdwcm9kdWN0cy1saXN0JywKICBjb21wb25lbnRzOiB7IFByb2R1Y3RDcmVhdGUsIFBhZ2VIZWFkZXIgfSwKICBkYXRhICgpIHsKICAgIHJldHVybiB7CiAgICAgIHBlbmRpbmc6IGZhbHNlLAogICAgICBjdXJyZW50X3BhZ2U6IDEsCiAgICAgIGRhdGE6IFtdLAogICAgICB0b3RhbF9yb3dzOiAwLAogICAgICBwZXJfcGFnZTogMjAsCiAgICAgIGZpZWxkczogW3sKICAgICAgICBrZXk6ICd2ZW5kb3JfY29kZScsCiAgICAgICAgbGFiZWw6ICfQkNGA0YLQuNC60YPQuycsCiAgICAgICAgc29ydGFibGU6IHRydWUKICAgICAgfSwKICAgICAgewogICAgICAgIGtleTogJ25hbWUnLAogICAgICAgIGxhYmVsOiAn0J3QsNC30LLQsNC90LjQtScsCiAgICAgICAgc29ydGFibGU6IHRydWUKICAgICAgfSwKICAgICAgewogICAgICAgIGtleTogJ3Byb2R1Y3RzX2dyb3VwJywKICAgICAgICBsYWJlbDogJ9CT0YDRg9C/0L/QsCcsCiAgICAgICAgc29ydGFibGU6IHRydWUKICAgICAgfSwKICAgICAgewogICAgICAgIGtleTogJ2Nvc3QnLAogICAgICAgIGxhYmVsOiAn0KHQvtGC0LjQvNC+0YHRgtGMJywKICAgICAgICBzb3J0YWJsZTogdHJ1ZQogICAgICB9LAogICAgICB7CiAgICAgICAgbGFiZWw6ICfQodGC0LDRgtGD0YEnCiAgICAgIH1dLAogICAgICB0YWJsZV9zb3J0aW5nOiB7CiAgICAgICAgc29ydF9ieTogJ25hbWUnLAogICAgICAgIHNvcnRfZGVzYzogZmFsc2UKICAgICAgfSwKICAgICAgaXNfY3JlYXRlOiBmYWxzZQogICAgfQogIH0sCgogIGNyZWF0ZWQgKCkgewogICAgdGhpcy5nZXRfcHJvZHVjdHNfbGlzdCgpCiAgfSwKCiAgd2F0Y2g6IHsKICAgIHRhYmxlX3NvcnRpbmc6IHsKICAgICAgaGFuZGxlcjogYXN5bmMgZnVuY3Rpb24gKG5ld190YWJsZV9zb3J0aW5nKSB7CiAgICAgICAgZGVib3VuY2UoYXN5bmMgKG5ld190YWJsZV9zb3J0aW5nKSA9PiB7CiAgICAgICAgICBpZiAobmV3X3RhYmxlX3NvcnRpbmcuc29ydF9ieSkgewogICAgICAgICAgICB0aGlzLnRvZ2dsZV9wZW5kaW5nKCkKICAgICAgICAgICAgbmV3IEFqYXhPcGVyYXRvcigncHJvZHVjdHNfbGlzdCcsIHRoaXMuJHN0b3JlLCAncHJvZHVjdHMnKS5nZXQoewogICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgcGFnZTogdGhpcy5jdXJyZW50X3BhZ2UsCiAgICAgICAgICAgICAgICBsaW1pdDogdGhpcy5wZXJfcGFnZSwKICAgICAgICAgICAgICAgIHNvcnRfYnk6IG5ld190YWJsZV9zb3J0aW5nLnNvcnRfYnksCiAgICAgICAgICAgICAgICBzb3J0X2Rlc2M6IG5ld190YWJsZV9zb3J0aW5nLnNvcnRfZGVzYwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGEucmVzdWx0CiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3Jvd3MgPSBkYXRhLnRvdGFsCiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZV9wZW5kaW5nKCkKICAgICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgIH0sIDUwMCkobmV3X3RhYmxlX3NvcnRpbmcpCiAgICAgIH0sCiAgICAgIGRlZXA6IHRydWUKICAgIH0KICB9LAoKICBtZXRob2RzOiB7CiAgICB0b2dnbGVfcGVuZGluZyAoKSB7CiAgICAgIHRoaXMucGVuZGluZyA9ICF0aGlzLnBlbmRpbmcKICAgIH0sCgogICAgZ2V0X3Byb2R1Y3RzX2xpc3QgKHBhZ2UgPSAxKSB7CiAgICAgIHRoaXMudG9nZ2xlX3BlbmRpbmcoKQogICAgICBuZXcgQWpheE9wZXJhdG9yKCdwcm9kdWN0c19saXN0JywgdGhpcy4kc3RvcmUsICdwcm9kdWN0cycpLmdldCh7CiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICBwYWdlLAogICAgICAgICAgbGltaXQ6IHRoaXMucGVyX3BhZ2UsCiAgICAgICAgICBzb3J0X2J5OiB0aGlzLnRhYmxlX3NvcnRpbmcuc29ydF9ieSwKICAgICAgICAgIHNvcnRfZGVzYzogdGhpcy50YWJsZV9zb3J0aW5nLnNvcnRfZGVzYwogICAgICAgIH0KICAgICAgfSkKICAgICAgICAudGhlbihkYXRhID0+IHsKICAgICAgICAgIHRoaXMuZGF0YSA9IFtdCiAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhLnJlc3VsdAogICAgICAgICAgdGhpcy50b3RhbF9yb3dzID0gZGF0YS50b3RhbAogICAgICAgICAgdGhpcy50b2dnbGVfcGVuZGluZygpCiAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhCiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goZSA9PiB7CiAgICAgICAgICB0aGlzLnRvZ2dsZV9wZW5kaW5nKCkKICAgICAgICAgIGlmIChlLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB0aGlzLiRyb3V0ZXIucHVzaCh7IG5hbWU6ICdsb2dpbicsIHBhcmFtczogeyBlcnJvcl90ZXh0OiAn0JLQvtC50LTRgtC40YLQtSDQsiDQu9C40YfQvdGL0Lkg0LrQsNCx0LjQvdC10YInIH0gfSkKICAgICAgICB9KQogICAgfQogIH0KfQo="},{"version":3,"sources":["ProductsList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ProductsList.vue","sourceRoot":"src/components/product","sourcesContent":["<template>\n  <div>\n    <page-header title=\"Список товаров\">\n      <template slot=\"actions\">\n        <b-button variant=\"warning\" squared class=\"d-flex align-items-center\" @click=\"is_create = !is_create\">\n          <img src=\"../../assets/plus-warning-filled.png\" width=\"24\" hight=\"24\"/>\n          <span>Создать заявку</span>\n        </b-button>\n      </template>\n    </page-header>\n    <product-create v-if=\"is_create\"\n                    @close=\"is_create = $event\"\n                    title=\"Новая заявка на добавление товара\"\n    ></product-create>\n    <b-table id=\"products_list\" hover small no-local-sorting\n             style=\"border: 2px solid white; font-size: 13px; line-height: 16px\"\n             :busy=\"pending\"\n             :items=\"data\"\n             :fields=\"fields\"\n             :sort-by.sync=\"table_sorting.sort_by\"\n             :sort-desc.sync=\"table_sorting.sort_desc\"\n             :current-page=\"current_page\">\n      <template v-slot:table-busy>\n        <div class=\"text-center text-danger my-2\">\n          <b-spinner class=\"align-middle\"></b-spinner>\n          <strong>Загрузка...</strong>\n        </div>\n      </template>\n    </b-table>\n    <b-pagination v-model=\"current_page\"\n                :total-rows=\"total_rows\"\n                :per-page=\"per_page\"\n                @change=\"get_products_list\"\n                aria-controls=\"products_list\"></b-pagination>\n  </div>\n</template>\n\n<script>\nimport PageHeader from '../common/PageHeader'\nimport { AjaxOperator } from '../../lib/axios'\nimport debounce from 'lodash.debounce'\nimport ProductCreate from './ProductCreate'\nexport default {\n  name: 'products-list',\n  components: { ProductCreate, PageHeader },\n  data () {\n    return {\n      pending: false,\n      current_page: 1,\n      data: [],\n      total_rows: 0,\n      per_page: 20,\n      fields: [{\n        key: 'vendor_code',\n        label: 'Артикул',\n        sortable: true\n      },\n      {\n        key: 'name',\n        label: 'Название',\n        sortable: true\n      },\n      {\n        key: 'products_group',\n        label: 'Группа',\n        sortable: true\n      },\n      {\n        key: 'cost',\n        label: 'Сотимость',\n        sortable: true\n      },\n      {\n        label: 'Статус'\n      }],\n      table_sorting: {\n        sort_by: 'name',\n        sort_desc: false\n      },\n      is_create: false\n    }\n  },\n\n  created () {\n    this.get_products_list()\n  },\n\n  watch: {\n    table_sorting: {\n      handler: async function (new_table_sorting) {\n        debounce(async (new_table_sorting) => {\n          if (new_table_sorting.sort_by) {\n            this.toggle_pending()\n            new AjaxOperator('products_list', this.$store, 'products').get({\n              params: {\n                page: this.current_page,\n                limit: this.per_page,\n                sort_by: new_table_sorting.sort_by,\n                sort_desc: new_table_sorting.sort_desc\n              }\n            })\n              .then(data => {\n                this.data = data.result\n                this.total_rows = data.total\n                this.toggle_pending()\n              })\n          }\n        }, 500)(new_table_sorting)\n      },\n      deep: true\n    }\n  },\n\n  methods: {\n    toggle_pending () {\n      this.pending = !this.pending\n    },\n\n    get_products_list (page = 1) {\n      this.toggle_pending()\n      new AjaxOperator('products_list', this.$store, 'products').get({\n        params: {\n          page,\n          limit: this.per_page,\n          sort_by: this.table_sorting.sort_by,\n          sort_desc: this.table_sorting.sort_desc\n        }\n      })\n        .then(data => {\n          this.data = []\n          this.data = data.result\n          this.total_rows = data.total\n          this.toggle_pending()\n          return this.data\n        })\n        .catch(e => {\n          this.toggle_pending()\n          if (e.response.status === 404) this.$router.push({ name: 'login', params: { error_text: 'Войдтите в личный кабинет' } })\n        })\n    }\n  }\n}\n</script>\n"]}]}